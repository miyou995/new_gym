{% load i18n %}
{% load widget_tweaks %}
{% csrf_token %}

<div class="row">
    <div class="col-md-9">
        <!-- Calendar will be here -->
        <div id="calendar"></div>
    </div>
    <div class="col-md-3">
        <!-- Sidebar for selected events -->
        <div id="selected-events-sidebar" class="border p-3">
            <h4>Selected Events</h4>
            <p>No events selected.</p>
        </div>
    </div>
</div> 
<script>   
    var selectedEvents  = [];
    function initCalendar(eventsData) {
        var calendarEl = document.getElementById('calendar');
        var calendar = new FullCalendar.Calendar(calendarEl, {
            initialView: 'dayGridMonth',
            headerToolbar: {
                left: 'prev,next today', 
                center: 'title',
                right: 'dayGridMonth,timeGridWeek,timeGridDay'
            },
            slotMinTime: '06:00:00',
            slotDuration: '01:00:00',
            events: eventsData,
            {% comment %} eventClick: function(info) {
                info.jsEvent.preventDefault(); // Prevent the default browser behavior
                var url = info.event.url;
                htmx.ajax('GET', url, {
                    target: '#kt_modal_content', // The ID of the element where the content will be loaded
                    swap: 'innerHTML', // Swap the innerHTML of the target element with the response
                });
                var myModal = new bootstrap.Modal(document.getElementById('kt_modal'));
                myModal.show();
            }, {% endcomment %}
            selectable: true,  // Enable selecting events
            eventClick: function(info) {
                info.jsEvent.preventDefault(); // Prevent the default browser behavior
                
                var selectedEvent = {
                    title: info.event.title,
                    startTime: info.event.start,
                    endTime: info.event.end,
                    url: info.event.url
                };
                
                // Check if the event is already selected
                var index = selectedEvents.findIndex(event => event.url === selectedEvent.url);
                
                if (index === -1) {
                    selectedEvents.push(selectedEvent); // Add event to selectedEvents
                } else {
                    selectedEvents.splice(index, 1); // Remove event if already selected
                }
                
                // Update the sidebar with selected events
               console.log(selectedEvents)
                updateSidebar(selectedEvents);
            }
          
        });
        calendar.render();
    }
    function updateSidebar(selectedEvents) {
        var sidebar = document.getElementById('selected-events-sidebar');
        sidebar.innerHTML = ''; // Clear previous content
        
        if (selectedEvents.length === 0) {
            sidebar.innerHTML = '<p>No events selected.</p>';
        } else {
            selectedEvents.forEach(function(event) {
                var eventHtml = `<div class="event-item">
                                    <h5>${event.title}</h5>
                                    <p>${event.startTime.toLocaleString()} - ${event.endTime.toLocaleString()}</p>
                                    {% comment %} <a href="${event.url}" class="btn btn-sm btn-primary" hx-get="${event.url}" hx-target="#kt_modal_content" hx-swap="innerHTML" data-bs-toggle="modal" data-bs-target="#kt_modal">View Details</a> {% endcomment %}
                                 </div>`;
                sidebar.innerHTML += eventHtml;
            });
        }
    }

    document.addEventListener('DOMContentLoaded', function() {
        initCalendar({{ events|safe }});
    });
    document.addEventListener('DOMContentLoaded', function () {
        // Select the form element
        const form = document.getElementById('form_id'); // Replace 'yourFormId' with the actual ID of your form
    
        // Add an event listener to all input elements within the form
        form.querySelectorAll('input, select, textarea').forEach(function(element) {
            element.addEventListener('change', function() {
                // Submit the form when an input changes
                form.submit();
            });
        });
    });
</script>